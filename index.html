<!DOCTYPE html>
<html>
<head>
  <title>School Portal</title>
  <style>
    body {
      font-family: Arial;
      margin: 20px;
    }
    h2 {
      color: #007bff;
    }
    .section {
      margin-bottom: 30px;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 8px;
    }
    input[type="text"], select {
      padding: 5px;
      margin: 4px 0;
      width: 200px;
    }
    button {
      padding: 5px 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>School Portal</h1>

<div class="section" id="admin-panel">
  <h2>Admin Panel - Add Subjects</h2>
  <label>Year Level:
    <select id="admin-year">
      <option value="1st Year">1st Year</option>
      <option value="2nd Year">2nd Year</option>
    </select>
  </label><br>
  <label>Course: <input type="text" id="admin-course"></label><br>
  <label>Term: <input type="text" id="admin-term"></label><br>
  <label>Subject: <input type="text" id="admin-subject"></label><br>
  <button onclick="saveSubject()">Save Subject</button>
</div>

<div class="section" id="enroll-student">
  <h2>Enroll Student</h2>
  <label>Full Name: <input type="text" id="student-name"></label><br>
  <label>Course: <input type="text" id="student-course"></label><br>
  <label>Year Level:
    <select id="student-year">
      <option value="1st Year">1st Year</option>
      <option value="2nd Year">2nd Year</option>
    </select>
  </label><br>
  <label>Term: <input type="text" id="student-term"></label><br>
  <button onclick="enrollStudent()">Add Student</button>
</div>

<div class="section" id="grade-entry">
  <h2>Enter Grades</h2>
  <label>Select Student:
    <select id="grade-student" onchange="loadSubjectsForStudent()"></select>
  </label>
  <div id="subject-grades"></div>
</div>

<div class="section" id="student-portal">
  <h2>Student Portal</h2>
  <label>View Grades for:
    <select id="view-student" onchange="showStudentGrades()"></select>
  </label>
  <table id="grades-table" style="margin-top: 10px;">
    <thead>
      <tr>
        <th>Subject</th>
        <th>Average</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const students = [];
  const subjects = [];

  function saveSubject() {
    const year = document.getElementById('admin-year').value;
    const course = document.getElementById('admin-course').value;
    const term = document.getElementById('admin-term').value;
    const subject = document.getElementById('admin-subject').value;
    if (!subject) return alert("Please enter a subject.");

    subjects.push({ year, course, term, name: subject });
    alert("Subject saved.");
  }

  function enrollStudent() {
    const name = document.getElementById('student-name').value;
    const course = document.getElementById('student-course').value;
    const year = document.getElementById('student-year').value;
    const term = document.getElementById('student-term').value;

    if (!name || !course || !term) return alert("Please complete all fields.");
    students.push({ name, course, year, term, grades: {} });

    updateStudentDropdowns();
    alert("Student enrolled.");
  }

  function updateStudentDropdowns() {
    const studentSelects = [document.getElementById('grade-student'), document.getElementById('view-student')];
    studentSelects.forEach(select => {
      select.innerHTML = students.map((s, i) => `<option value="${i}">${s.name}</option>`).join('');
    });
  }

  function loadSubjectsForStudent() {
    const studentIndex = document.getElementById('grade-student').value;
    const student = students[studentIndex];
    const filteredSubjects = subjects.filter(s => s.year === student.year && s.course === student.course && s.term === student.term);

    const container = document.getElementById('subject-grades');
    container.innerHTML = '';

    filteredSubjects.forEach(sub => {
      container.innerHTML += `
        <div style="margin-bottom:10px">
          <strong>${sub.name}</strong><br>
          Midterm: <input type="number" id="mid-${sub.name}"> 
          Final: <input type="number" id="fin-${sub.name}"> 
          <button onclick="saveGrade(${studentIndex}, '${sub.name}')">Save Grade</button>
        </div>
      `;
    });
  }

  function saveGrade(studentIndex, subjectName) {
    const mid = parseFloat(document.getElementById(`mid-${subjectName}`).value);
    const fin = parseFloat(document.getElementById(`fin-${subjectName}`).value);
    const avg = ((mid + fin) / 2).toFixed(2);

    students[studentIndex].grades[subjectName] = avg;
    alert(`Saved grade for ${subjectName}: ${avg}`);
  }

  function showStudentGrades() {
    const studentIndex = document.getElementById('view-student').value;
    const student = students[studentIndex];
    const tableBody = document.querySelector("#grades-table tbody");

    tableBody.innerHTML = '';
    for (let subject in student.grades) {
      tableBody.innerHTML += `
        <tr>
          <td>${subject}</td>
          <td>${student.grades[subject]}</td>
        </tr>
      `;
    }
  }
</script>

</body>
</html>
